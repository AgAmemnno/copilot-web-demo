WebアニメーションAPIの概念
Web Animations API（WAAPI）は、JavaScript開発者にブラウザのアニメーションエンジンへのアクセスを提供し、様々なブラウザでアニメーションを実装する方法を規定しています。この記事では、WAAPIの重要な概念を紹介し、その仕組みを理論的に理解することで、効果的に活用できるようにします。APIの使い方については、姉妹記事「Web Animations APIの使用」をご覧ください。

Web Animations APIは、宣言的なCSSアニメーションやトランジションと、動的なJavaScriptアニメーションの間のギャップを埋めます。つまり、Web Animations APIを使うことで、定義済みの状態から別の状態へと遷移するCSS風のアニメーションを作成・操作したり、変数、ループ、コールバックを使って、変化する入力に適応して反応するインタラクティブなアニメーションを作成したりすることができます。

歴史
10年以上前、Synchronized Multimedia Integration Language（SMIL、発音は「スマイル」）がSVGにアニメーションをもたらしました。当時、ブラウザが唯一気にするアニメーションエンジンはSMILでした。5つのブラウザのうち4つがSMILをサポートしていましたが、SMILはSVG要素のみをアニメーション化し、CSSからは利用できず、非常に複雑だったため、実装に一貫性がないことがよくありました。10年後、SafariチームはCSS AnimationsとCSS Transitionsの仕様を導入しました。

Internet Explorerチームは、すべてのブラウザでアニメーション機能を統合・標準化するためのアニメーションAPIの導入を要請しました。これを受けて、Mozilla FirefoxとGoogle Chromeの開発者の間で、すべてのブラウザを統括する単一のアニメーション仕様、Web Animations APIの策定に向けた本格的な取り組みが始まりました。そして今、WAAPIが完成しました。WAAPIは将来のアニメーション仕様に便乗することで、それらの一貫性を保ち、相互に連携できるようになります。また、WAAPIは、すべてのブラウザが現在利用可能な仕様に準拠できる基準点となります。

CSS トランジションとアニメーションよりも Web アニメーション API が優先されていること、および疑問符が付いた将来のアニメーション仕様を表す 3 番目のカテゴリを示すイラスト。

2つのモデル：タイミングとアニメーション
Web Animations APIは、時間を扱うモデル（タイミングモデル）と、時間経過に伴う視覚的な変化を扱うモデル（アニメーションモデル）の2つのモデルに基づいて動作します。タイミングモデルは、設定されたタイムラインの進行状況を追跡します。アニメーションモデルは、アニメーション化されたオブジェクトが特定の時点でどのように見えるかを決定します。

タイミング
タイミングモデルは、WAAPI を扱う上での基盤となるものです。各ドキュメントにはDocument.timeline、ページが読み込まれた瞬間から無限に、あるいはウィンドウが閉じられるまで続くマスタータイムライン が存在します。このタイムライン上に、アニメーションが再生時間に応じて配置されています。各アニメーションは によってタイムライン上の特定のポイントに固定されておりstartTime、ドキュメントのタイムライン上でアニメーションの再生が開始される瞬間を表しています。

すべてのアニメーションの再生はこのタイムラインに依存しています。アニメーションをシークすると、タイムライン上のアニメーションの位置が移動します。再生速度を遅くしたり速くしたりすると、タイムライン上のアニメーションの広がりが縮小または拡大します。アニメーションを繰り返すと、タイムライン上にアニメーションの反復が追加されます。将来的には、ジェスチャーやスクロール位置に基づいたタイムライン、さらには親子のタイムラインも実現されるかもしれません。Web Animations API は、実に多くの可能性を切り開きます。

アニメーション
アニメーション モデルは、アニメーションの継続時間に沿って並べられた、特定の時点でのアニメーションの外観を示すスナップショットの配列と考えることができます。

アニメーションモデルをタイムラインに沿って並べた一連のスナップショットとして視覚化する方法を示したイラスト。この例では、チェシャ猫が0秒（そこにいる）から8秒（まだ全部ではなく、笑顔だけが残っている）までを撮影した画像が使用されています。

コアコンセプト
ウェブアニメーションは、タイムラインオブジェクト、アニメーションオブジェクト、アニメーションエフェクトオブジェクトが連携して動作します。これらのオブジェクトを組み合わせることで、独自のアニメーションを作成できます。

タイムライン
タイムラインオブジェクトはcurrentTime、ページが開かれてからどれくらいの時間が経過したかを確認できる便利なプロパティ をtimeline提供します。これは、ページが開かれた時点から始まる、ドキュメントのタイムラインの「現在時刻」です。この記事の執筆時点では、タイムラインオブジェクトはアクティブドキュメントの に基づくもののみ存在します。将来的には、ページの長さ（おそらく ）に対応するタイムラインオブジェクトScrollTimelineや、全く別のものに対応するタイムラインオブジェクトが登場するかもしれません。

アニメーション
アニメーションオブジェクトはDVDプレーヤーのようなものだと考えてください。メディアの再生を制御するために使用されますが、再生するメディアがなければ何もしません。アニメーションオブジェクトは、アニメーション効果、特にキーフレーム効果（後ほど説明します）の形でメディアを受け取ります。DVDプレーヤーと同様に、アニメーションオブジェクトのメソッドを使って、再生、一時停止、シーク、そしてアニメーションの再生方向と速度の制御を行うことができます。

DVD プレーヤーが DVD を再生するのと同じように、アニメーションが KeyframeEffect を再生する様子を示す図。

アニメーション効果
アニメーションオブジェクトをDVDプレーヤーとすれば、アニメーションエフェクト（キーフレームエフェクト）はDVDと考えることができます。キーフレームエフェクトは、最低限必要なキーセットとアニメーションに必要な持続時間を含む情報の束です。アニメーションオブジェクトはこの情報を受け取り、タイムラインオブジェクトを使用して、表示および参照可能な再生可能なアニメーションを組み立てます。

現在利用可能なアニメーション効果の種類は のみです。KeyframeEffect将来的には、Flash で実現していた機能に似た、グループ化やシーケンス化のための効果など、あらゆる種類のアニメーション効果を利用できるようになる可能性があります。実際、グループ効果とシーケンス効果は、現在策定中の Web Animations API レベル 2 仕様で既に概要が示されています。

さまざまな部分からアニメーションを組み立てる
これらすべての要素を組み合わせて、Animation()コンストラクターで動作するアニメーションを作成することも、ショートカット関数を使用することもできますElement.animate()。(使用方法の詳細については、「Web Animations APIElement.animate()の使用」を参照してください。)

用途
このAPIを使用すると、CSSで作成するようなより単純で宣言的なアニメーションだけでなく、リアルタイムで更新できる動的なアニメーションも作成できます。UIアニメーションが正しく動作しているかどうかを確認するための自動テストにも使用できます。ブラウザのレンダリングエンジンを利用して、タイムラインなどのアニメーション開発ツールを構築できます。また、カスタムまたは商用のアニメーションライブラリを構築するための高性能な基盤としても機能します（Element.animateでアニメーションを気楽に作る方法をご覧ください）。場合によっては、JQueryなしでVanilla JavaScriptを様々な用途で使用できるのと同様に、このAPIによって本格的なライブラリが全く不要になることもあります。

参照
WebアニメーションAPI — メインページ
Web Animations APIの使用ガイド
CodePen には「不思議の国のアリス」のデモがすべて揃っているので、自由に試したり、フォークしたり、共有したりできます。
web-animations-js — Web Animations API ポリフィル