<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキスト長・文字数固定調整 テスターベース</title>
    <style>
        /* Google Fonts の読み込み */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,slnt,wdth,wght@8..144,-10..0,25..151,100..1000&display=swap');

        :root {
            --root-font-size: 16px;
            --writing-mode: horizontal-tb;
            --direction: ltr;
        }

        html {
            font-family: 'Inter', sans-serif;
            font-size: var(--root-font-size);
            writing-mode: var(--writing-mode);
            direction: var(--direction);
        }

        body {
            background-color: #f0f4f8;
            color: #2d3748;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .app-container {
            margin-block-start: 20px;
            margin-block-end: 20px;
            margin-inline-start: auto;
            margin-inline-end: auto;
            max-inline-size: 64rem; 
            background-color: #ffffff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            padding-block: 1.5rem; 
            padding-inline: 1.5rem;
            box-sizing: border-box;
        }
        @media (min-inline-size: 768px) {
            .app-container {
                padding-block: 2rem;
                padding-inline: 2rem;
            }
        }

        header {
            margin-block-end: 1rem; 
            text-align: center;
        }

        header h1 {
            font-size: 1.875rem; 
            line-height: 1.2;
            font-weight: 700; 
            color: #2563eb; 
        }

        header p {
            color: #4b5563; 
            margin-block-start: 0.5rem; 
        }
        
        .control-panel {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-block-end: 30px;
            inline-size: 100%;
            max-inline-size: 600px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            border: 1px solid #e2e8f0;
        }

        .control-panel h2 {
            grid-column: 1 / -1; 
            font-size: 1.5em;
            font-weight: 700;
            color: #2c5282; 
            margin-block-start: 0;
            margin-block-end: 10px;
            border-block-end: 2px solid #e2e8f0; 
            padding-block-end: 10px;
        }
        
        .control-group {
            background-color: #f7fafc; 
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-block-end: 8px;
            color: #4a5568; 
            font-size: 0.9em;
        }

        .control-group input[type="number"],
        .control-group select {
            inline-size: 100%;
            padding-block: 10px;
            padding-inline: 10px;
            border: 1px solid #cbd5e0; 
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            margin-block-start: 4px;
        }
        .control-group input[type="number"]:focus, 
        .control-group select:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
        }

        #taskSpecificArea { /* 新しいタスクのための表示エリア */
            margin-block-start: 2rem;
            padding: 1.5rem;
            border: 2px dashed #60a5fa; /* Blue dashed border */
            border-radius: 0.375rem;
            background-color: #eff6ff; /* Light blue background */
            min-block-size: 200px;
        }
        #taskSpecificArea h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e40af; /* Darker blue */
            margin-block-start: 0;
            margin-block-end: 1rem;
        }

    </style>
</head>
<body>
    <div class="control-panel">
        <h2>グローバル環境設定</h2>
        <div class="control-group">
            <label for="writingModeSelect">書字方向 (Writing Mode):</label>
            <select id="writingModeSelect">
                <option value="horizontal-tb" selected>horizontal-tb (横書き)</option>
                <option value="vertical-rl">vertical-rl (縦書き・右から)</option>
                <option value="vertical-lr">vertical-lr (縦書き・左から)</option>
            </select>
        </div>
        <div class="control-group">
            <label for="directionSelect">テキスト方向 (Direction):</label>
            <select id="directionSelect">
                <option value="ltr" selected>ltr (左から右へ / 上から下へ)</option>
                <option value="rtl">rtl (右から左へ / 下から上へ)</option>
            </select>
        </div>
        <div class="control-group">
            <label for="rootFontSize">ルートフォントサイズ (px):</label>
            <input type="number" id="rootFontSize" value="16" min="8">
        </div>
        <div class="control-group">
            <label for="fontFamilySelect">フォントファミリー:</label>
            <select id="fontFamilySelect">
                <option value="'Inter', sans-serif">Inter</option>
                <option value="'Roboto Flex', sans-serif">Roboto Flex</option>
                <option value="'Roboto Slab', serif">Roboto Slab</option>
                <option value="'Source Code Pro', monospace">Source Code Pro</option>
                <option value="'Merriweather', serif">Merriweather</option>
                <option value="'Noto Sans JP', sans-serif">Noto Sans JP</option>
                <option value="serif">Serif (Generic)</option>
                <option value="sans-serif">Sans-serif (Generic)</option>
            </select>
        </div>
    </div>
    
    <div class="app-container">
        <header>
            <h1>テキスト長・文字数固定調整</h1>
            <p>指定された文字数のテキストを、目標の長さに収めるための調整を行います。</p>
        </header>
        
        <div id="taskSpecificArea">
            <h2>調整エリア (ここにUIと表示が追加されます)</h2>
            </div>
    </div>

    <script>
        // --- DOM Element References ---
        const rootFontSizeInputElement = document.getElementById('rootFontSize');
        const fontFamilySelectElement = document.getElementById('fontFamilySelect');
        const writingModeSelectElement = document.getElementById('writingModeSelect');
        const directionSelectElement = document.getElementById('directionSelect');
        const taskSpecificArea = document.getElementById('taskSpecificArea');

        // --- Helper Functions (Keep for potential use in new task) ---
        function measureDimension(unitToMeasure, options = {}) {
            const tempEl = document.createElement('div'); 
            const referenceElement = options.referenceElement || document.documentElement;
            const refStyle = window.getComputedStyle(referenceElement);

            tempEl.style.fontFamily = refStyle.fontFamily;
            tempEl.style.fontSize = options.fontSizeToApply || refStyle.fontSize; 
            tempEl.style.writingMode = options.writingMode || refStyle.writingMode;
            tempEl.style.direction = options.direction || refStyle.direction;    

            tempEl.style.position = 'absolute';
            tempEl.style.visibility = 'hidden';
            tempEl.style.padding = '0';
            tempEl.style.border = '0';
            tempEl.style.lineHeight = 'normal'; 

            let dimension = 0;

            if (unitToMeasure.endsWith('ex') || unitToMeasure.endsWith('cap') || unitToMeasure.endsWith('lh') || unitToMeasure.endsWith('rem') || unitToMeasure.endsWith('em')) {
                tempEl.style.blockSize = unitToMeasure; 
                tempEl.style.inlineSize = '1px'; 
            } else if (unitToMeasure.endsWith('ch')) {
                tempEl.style.inlineSize = unitToMeasure; 
                tempEl.style.blockSize = '1px'; 
            } else {
                // console.warn("Unsupported unit for measurement:", unitToMeasure);
                return 0; // Return 0 if unit is not recognized for simple measurement
            }
            
            document.body.appendChild(tempEl);
            const rect = tempEl.getBoundingClientRect();
            
            if (unitToMeasure.endsWith('ex') || unitToMeasure.endsWith('cap') || unitToMeasure.endsWith('lh') || unitToMeasure.endsWith('rem') || unitToMeasure.endsWith('em')) {
                dimension = rect.height;
            } else if (unitToMeasure.endsWith('ch')) {
                dimension = rect.width;
            }
            
            document.body.removeChild(tempEl);
            return dimension;
        }

        // --- Main Logic ---
        function applyGlobalStyles() {
            const newRootFontSize = parseFloat(rootFontSizeInputElement.value);
            if (!isNaN(newRootFontSize) && newRootFontSize > 0) {
                document.documentElement.style.setProperty('--root-font-size', `${newRootFontSize}px`);
                document.documentElement.style.fontSize = `var(--root-font-size)`;
            }
            document.documentElement.style.fontFamily = fontFamilySelectElement.value;
            document.documentElement.style.writingMode = writingModeSelectElement.value;
            document.documentElement.style.direction = directionSelectElement.value;
            
            // Future: Trigger re-calculation for the new task if needed
            console.log("Global styles applied. Root Font Size:", newRootFontSize, "Family:", fontFamilySelectElement.value);
            console.log("Writing Mode:", writingModeSelectElement.value, "Direction:", directionSelectElement.value);

            // Example: Display current root font size in a dedicated element if it exists
            const rootFontSizeDisplay = document.getElementById('rootFontSizeDisplay'); // Placeholder ID
            if(rootFontSizeDisplay) rootFontSizeDisplay.textContent = `${newRootFontSize.toFixed(2)}px`;
        }

        // --- Event Listeners ---
        [rootFontSizeInputElement, fontFamilySelectElement, writingModeSelectElement, directionSelectElement].forEach(el => {
            if (el) el.addEventListener('input', applyGlobalStyles);
        });
        
        // --- Initial Display ---
        document.fonts.ready.then(() => {
            applyGlobalStyles();
            // Placeholder for new task initialization
            taskSpecificArea.innerHTML += "<p>新しいタスクのUIと表示をここに追加します。</p>";
        }).catch(err => {
            console.error("Font loading error:", err);
            taskSpecificArea.innerHTML = "<p style='color:red;'>フォントの読み込みに失敗しました。ページを再読み込みしてください。</p>";
        });
    </script>
</body>
</html>
